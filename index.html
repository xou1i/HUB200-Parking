<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.marmot-cloud.com/npm/hylid-bridge/2.10.0/index.js"></script>
    <link rel="stylesheet" href="style.css">
    <script src="script.js"></script>
    <title>HUB200 Parking</title>
</head>
<body>
    
    <h1 id="h1">Welcome to HUB200 Parking</h1>

    <!-- Login AUTH CODE -->

    <button id="Login" onclick="Login()">
        Login to Parking
    </button>

    <!-- Scan QR CODE -->
        <button id="QR" onclick="Scan()">
            Scan QR Code
        </button>

        <button id="Pay" onclick="Pay()">
            Pay Parking Fee
        </button>

    <script>
    const state = {
        authCode: '',
        token: '',
        paymentUrl: '',
        paymentId: '',
        paymentAmount: 0  
    }

    // Login to get AUTH CODE
    function Login() {
        my.getAuthCode({
        scopes: ['auth_base'],
        success: (res) => {
            document.write({
            content: res.authCode,
            });
    },
            fail: (res) => {
            console.log(res.authErrorScopes)
        },
        });
    }



    // Scan QR Code
    function Scan() {
        if (typeof my === 'undefined') {
            console.error('my object is not available. Make sure the bridge is loaded.');
            return;
        }
        
        if (typeof my.scan !== 'function') {
            if (typeof my.canIUse === 'function' && !my.canIUse('scan')) {
                console.error('my.scan is not available, client version too low');
            }
            return;
        }
        
        my.scan({ 
            type: 'qr',
            hideAlbum: false,
            success:(res)=>{
                document.write('scan success:', res);
            },
            fail:(error)=>{
                console.error('scan fail:', error);
                let errorMessage = 'Scan failed';
                if (error.error) {
                    switch (error.error) {
                        case 10:
                            errorMessage = 'User cancelled scanning';
                            break;
                        case 11:
                            errorMessage = 'Operation failed';
                            break;
                        default:
                            errorMessage = error.errorMessage || 'Unknown error occurred';
                    }
                }
                console.error('scan fail:', errorMessage);
            },
            complete:(res)=>{
                console.log('scan complete:', res);
            }
        }); 
    }
    

    // Pay Parking Fee
    function Pay() {
        my.tradePay({
        paymentUrl: 'https://its.mouamle.space/api/payment', 
            success: (res) => {
                my.alert({
        content: JSON.stringify(res),
        });
    },
        fail: (res) => {
        my.alert({
        content: JSON.stringify(res),
    });
   }
   });
}

    </script>
</body>
</html>